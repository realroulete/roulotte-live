<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex, nofollow">
    <title>Admin - Panel Roulotte</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --accent: #f1c40f; --success: #2ecc71; --danger: #e74c3c; }
        body { background: #050505; color: white; font-family: sans-serif; padding: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .card { background: #111; border: 1px solid #222; padding: 15px; border-radius: 10px; }
        video { width: 100%; border-radius: 5px; }
        button { padding: 8px; border: none; cursor: pointer; font-weight: bold; border-radius: 4px; }
        .btn-app { background: var(--success); margin-right: 5px; }
        .btn-rej { background: var(--danger); color: white; }
        .ban-section { background: #1a1111; border: 1px solid var(--danger); padding: 20px; margin-top: 40px; border-radius: 10px; }
    </style>
</head>
<body>
    <h1>Solicitudes VIP</h1>
    <div id="lista-solicitudes" class="grid"></div>

    <div class="ban-section">
        <h2>Banear Usuario Permanentemente</h2>
        <input type="email" id="ban-email" placeholder="Email del usuario">
        <input type="text" id="ban-reason" placeholder="Motivo del baneo">
        <button class="btn-rej" onclick="ejecutarBaneo()">BANEAR AHORA</button>
    </div>

    <script>
        const supa = supabase.createClient("TU_URL", "TU_KEY");

        async function cargar() {
            const { data } = await supa.from('verification_requests').select('*');
            const cont = document.getElementById('lista-solicitudes');
            cont.innerHTML = "";
            data.forEach(r => {
                const url = `TU_URL/storage/v1/object/public/verifications/${r.video_url}`;
                cont.innerHTML += `
                    <div class="card">
                        <p><strong>${r.username}</strong> (${r.email})</p>
                        <p>Reto: ${r.numbers}</p>
                        <video src="${url}" controls></video>
                        <button class="btn-app" onclick="alert('Crea la cuenta en Supabase Auth con: ${r.email}')">LISTO PARA REGISTRAR</button>
                        <button class="btn-rej" onclick="borrar('${r.id}', '${r.video_url}')">BORRAR</button>
                    </div>`;
            });
        }

        async function borrar(id, path) {
            await supa.from('verification_requests').delete().eq('id', id);
            await supa.storage.from('verifications').remove([path]);
            cargar();
        }

        async function ejecutarBaneo() {
            const email = document.getElementById('ban-email').value;
            const reason = document.getElementById('ban-reason').value;
            const { error } = await supa.from('banned_users').insert([{ email, reason }]);
            if (error) alert(error.message); else alert("Usuario baneado.");
        }

        window.onload = cargar;
    </script>
</body>
</html>
