<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex, nofollow">
    <title>Control index89</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --accent: #f1c40f; --success: #2ecc71; --danger: #e74c3c; }
        body { background: #050505; color: white; font-family: sans-serif; padding: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .card { background: #111; border: 1px solid #222; padding: 15px; border-radius: 8px; }
        video { width: 100%; border-radius: 4px; }
        button { width: 100%; padding: 10px; border: none; cursor: pointer; font-weight: bold; margin-top: 5px; }
        .btn-app { background: var(--success); }
        .btn-rej { background: var(--danger); color: white; }
    </style>
</head>
<body>
    <h1>Solicitudes VIP Pendientes</h1>
    <div id="lista-solicitudes" class="grid"></div>

    <h2 style="margin-top:50px; color:var(--danger)">Lista de IPs Baneadas</h2>
    <div id="lista-baneados" style="background:#111; padding:20px; border-radius:8px;"></div>

    <script>
        const SUPA_URL = "https://bojafgtowhtxujsjgqnq.supabase.co";
        const SUPA_SERVICE = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJvamFmZ3Rvd2h0eHVqc2pncW5xIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc3MTY3MzYyOSwiZXhwIjoyMDg3MjQ5NjI5fQ.JjT6WOLO-6AYH9uO3bMgCGFn3r0JBLRkFqW9XQuO1Ls"; 
        const supaAdmin = supabase.createClient(SUPA_URL, SUPA_SERVICE);

        async function cargar() {
            // Cargar Solicitudes
            const { data: reqs } = await supaAdmin.from('verification_requests').select('*');
            const cont = document.getElementById('lista-solicitudes');
            cont.innerHTML = "";
            reqs.forEach(r => {
                const url = `${SUPA_URL}/storage/v1/object/public/verifications/${r.video_url}`;
                cont.innerHTML += `
                    <div class="card">
                        <p>${r.username} (${r.email})</p>
                        <video src="${url}" controls></video>
                        <button class="btn-app" onclick="aprobar('${r.id}','${r.email}','${r.password}','${r.video_url}')">APROBAR</button>
                        <button class="btn-rej" onclick="borrar('${r.id}','${r.video_url}')">RECHAZAR</button>
                    </div>`;
            });

            // Cargar Baneados
            const { data: bans } = await supaAdmin.from('banned_users').select('*');
            const contBan = document.getElementById('lista-baneados');
            contBan.innerHTML = bans.map(b => `<p>ðŸš« IP: ${b.ip_address || 'Sin IP'} - Email: ${b.email || 'N/A'} - RazÃ³n: ${b.reason}</p>`).join("");
        }

        async function aprobar(id, email, pass, video) {
            const { error } = await supaAdmin.auth.admin.createUser({ email, password: pass, email_confirm: true });
            if (error) return alert(error.message);
            await supaAdmin.from('vip_users').insert([{ email }]);
            await borrar(id, video, false);
            alert("Aprobado."); cargar();
        }

        async function borrar(id, path, refresh = true) {
            await supaAdmin.from('verification_requests').delete().eq('id', id);
            await supaAdmin.storage.from('verifications').remove([path]);
            if(refresh) cargar();
        }

        window.onload = cargar;
    </script>
</body>
</html>
